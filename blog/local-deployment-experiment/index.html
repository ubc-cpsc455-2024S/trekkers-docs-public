<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.3.2">
<title data-rh="true">Local Deployment and a Glimpse Into Trek&#x27;s CI/CD System | Trekkers</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://ubc-cpsc455-2024S.github.io/trekkers-docs-public/img/trek-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://ubc-cpsc455-2024S.github.io/trekkers-docs-public/img/trek-social-card.jpg"><meta data-rh="true" property="og:url" content="https://ubc-cpsc455-2024S.github.io/trekkers-docs-public/blog/local-deployment-experiment"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Local Deployment and a Glimpse Into Trek&#x27;s CI/CD System | Trekkers"><meta data-rh="true" name="description" content="One of our goals as the Trekkers was always to be able to have a"><meta data-rh="true" property="og:description" content="One of our goals as the Trekkers was always to be able to have a"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2024-07-06T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://wyfx.ca/"><meta data-rh="true" property="article:tag" content="project,workflow,ci/cd"><link data-rh="true" rel="icon" href="/trekkers-docs-public/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://ubc-cpsc455-2024S.github.io/trekkers-docs-public/blog/local-deployment-experiment"><link data-rh="true" rel="alternate" href="https://ubc-cpsc455-2024S.github.io/trekkers-docs-public/blog/local-deployment-experiment" hreflang="en"><link data-rh="true" rel="alternate" href="https://ubc-cpsc455-2024S.github.io/trekkers-docs-public/blog/local-deployment-experiment" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://ubc-cpsc455-2024S.github.io/trekkers-docs-public/blog/local-deployment-experiment","mainEntityOfPage":"https://ubc-cpsc455-2024S.github.io/trekkers-docs-public/blog/local-deployment-experiment","url":"https://ubc-cpsc455-2024S.github.io/trekkers-docs-public/blog/local-deployment-experiment","headline":"Local Deployment and a Glimpse Into Trek's CI/CD System","name":"Local Deployment and a Glimpse Into Trek's CI/CD System","description":"One of our goals as the Trekkers was always to be able to have a","datePublished":"2024-07-06T00:00:00.000Z","author":{"@type":"Person","name":"William Xiao","description":"Developer","url":"https://wyfx.ca/","image":"https://wyfx.ca/misc/WX.jpg"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://ubc-cpsc455-2024S.github.io/trekkers-docs-public/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/trekkers-docs-public/blog/rss.xml" title="Trekkers RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/trekkers-docs-public/blog/atom.xml" title="Trekkers Atom Feed"><link rel="stylesheet" href="/trekkers-docs-public/assets/css/styles.08ff33e2.css">
<script src="/trekkers-docs-public/assets/js/runtime~main.beb0a0e1.js" defer="defer"></script>
<script src="/trekkers-docs-public/assets/js/main.03052e01.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><style data-mantine-styles="classes">@media (max-width: 35.99375em) {.mantine-visible-from-xs {display: none !important;}}@media (min-width: 36em) {.mantine-hidden-from-xs {display: none !important;}}@media (max-width: 47.99375em) {.mantine-visible-from-sm {display: none !important;}}@media (min-width: 48em) {.mantine-hidden-from-sm {display: none !important;}}@media (max-width: 61.99375em) {.mantine-visible-from-md {display: none !important;}}@media (min-width: 62em) {.mantine-hidden-from-md {display: none !important;}}@media (max-width: 74.99375em) {.mantine-visible-from-lg {display: none !important;}}@media (min-width: 75em) {.mantine-hidden-from-lg {display: none !important;}}@media (max-width: 87.99375em) {.mantine-visible-from-xl {display: none !important;}}@media (min-width: 88em) {.mantine-hidden-from-xl {display: none !important;}}</style><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/trekkers-docs-public/"><div class="navbar__logo"><img src="/trekkers-docs-public/img/Trekkers_Dark_Logo.svg" alt="Trekkers Logo" class="themedComponent_mlkZ themedComponent--light_NVdE" width="100px"><img src="/trekkers-docs-public/img/Trekkers_Light_Logo.svg" alt="Trekkers Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU" width="100px"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/trekkers-docs-public/docs/terms-of-reference">Development</a><a class="navbar__item navbar__link" href="/trekkers-docs-public/team">Team</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/trekkers-docs-public/blog">Blog</a><a class="navbar__item navbar__link" href="/trekkers-docs-public/docs/category/project-progress">Project Progress</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/ubc-cpsc455-2024S/project-04_trekkers" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/trekkers-docs-public/blog/trek-gis-study">Choosing the Best Geographic Information System (GIS) for Trek</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/trekkers-docs-public/blog/local-deployment-experiment">Local Deployment and a Glimpse Into Trek&#x27;s CI/CD System</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/trekkers-docs-public/blog/wip-3">Work In Progress 3</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/trekkers-docs-public/blog/project-workflow">A Deep Dive into Trekkers Project Workflow</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/trekkers-docs-public/blog/wip-2">Work In Progress 2</a></li></ul></nav></aside><main class="col col--7"><article><header><h1 class="title_f1Hy">Local Deployment and a Glimpse Into Trek&#x27;s CI/CD System</h1><div class="container_mt6G margin-vert--md"><time datetime="2024-07-06T00:00:00.000Z">July 6, 2024</time> · <!-- -->7 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://wyfx.ca/" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://wyfx.ca/misc/WX.jpg" alt="William Xiao"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://wyfx.ca/" target="_blank" rel="noopener noreferrer"><span>William Xiao</span></a></div><small class="avatar__subtitle">Developer</small></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p>One of our goals as the Trekkers was always to be able to have a
<strong>cost-effective</strong> but <strong>performant</strong> deployment of Trek. As someone who
self-hosts their own server for their <a href="https://wyfx.ca" target="_blank" rel="noopener noreferrer">personal site</a>, I
thought it would be quite suiting to see if our current needs for deployment and
CI/CD could be met through repurposing part of self-hosted solution.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="my-site">My Site<a href="#my-site" class="hash-link" aria-label="Direct link to My Site" title="Direct link to My Site">​</a></h2>
<p>As a little bit of background, my personal site (<a href="https://wyfx.ca" target="_blank" rel="noopener noreferrer">https://wyfx.ca</a>) was originally
started as just a way for me to take the Raspberry Pi I had sitting at home and
make it something useful.</p>
<p>The site was developed under Vite, and deployed under a Docker container running
nginx. Whenever I have a new version of the site, I build a new version of the
Docker container, then manually restart the container.</p>
<p>At Trek, one of our priorities is always knowing about the status of our
product. Hence, with some of my knowledge on the team, we aimed to leverage that
knowledge to develop our own self-hosted solution for development purposes.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="considerations">Considerations<a href="#considerations" class="hash-link" aria-label="Direct link to Considerations" title="Direct link to Considerations">​</a></h2>
<p>On the implementation side, moving from a simple statically hosted website to an
integrated solution with our GitHub workflow would not be easy. Our goals for
Trek&#x27;s deployment solution would be something that is <strong>integrated with
GitHub</strong>, <strong>performant</strong> enough to run on my Raspberry Pi, and <strong>automatic</strong>.
This solution would be key for our CI/CD process and would ensure that we&#x27;d able
to quickly iterate on new updates to our codebase.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="security">Security<a href="#security" class="hash-link" aria-label="Direct link to Security" title="Direct link to Security">​</a></h3>
<p>Security was especially important to me as we needed a solution that would not
expose my self-hosted server to too much risk, but would still be able to
automatically integrate with GitHub. My home server did not have a publicly
exposed SSH port, yet without one we would not be able to upload files to the
server. However, as my main account on the server was an administrator, I did
not want any possible SSH solutions to have full access to the administrator
account.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="performance">Performance<a href="#performance" class="hash-link" aria-label="Direct link to Performance" title="Direct link to Performance">​</a></h3>
<p>The second primary consideration with our design was performance. This includes
both the &quot;visible&quot; parts of the site (like API and frontend), but also the build
process from a successful push to GitHub. While we would not have to worry about
a large amount of users on the development site, we still wanted a solution that
would be performant enough for us to evaluate how the site would behave for
production deployment in the future. The limited compute power of the Raspberry
Pi also means that this deployment needs to be as lean as possible.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="maintainability">Maintainability<a href="#maintainability" class="hash-link" aria-label="Direct link to Maintainability" title="Direct link to Maintainability">​</a></h3>
<p>The last key consideration was maintainability. The development of Trek moves
quickly, so our system should be able to adapt to those changes quickly. Without
a maintainable system, the system could quickly become obsolete - sacrificing
valuable developer time.</p>
<hr>
<p>With all of our considerations in mind, we started the design of the CI/CD system.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="deployment">Deployment<a href="#deployment" class="hash-link" aria-label="Direct link to Deployment" title="Direct link to Deployment">​</a></h2>
<p>Since I was most familiar with a Docker container setup like my home server, my
initial thoughts were to create another container running on the server at the
same time as my personal site. So the first challenge was coming up with a
deployment that would allow both Docker containers to run at the same time while redirecting
to different domains.
My solution to this issue was to use
<a href="https://github.com/nginx-proxy/nginx-proxy" target="_blank" rel="noopener noreferrer">nginx-proxy</a>. <code>nginx-proxy</code>
essentially acts as a reverse proxy that routes to Docker containers by
subdomain. Now, I can start my own website&#x27;s container with an environment
variable <code>VIRTUAL_HOST=wyfx.ca</code>, while having Trek on a subdomain like
<code>SUBDOMAIN.wyfx.ca</code>. To handle HTTPS, I extended my original LetsEncrypt
certificates using
<a href="https://github.com/nginx-proxy/acme-companion" target="_blank" rel="noopener noreferrer">acme-companion</a>, which will
automatically generate a new HTTPS certificate for each of my subdomains by
specifying <code>LETSENCRYPT_HOST=SUBDOMAIN.wyfx.ca</code>.</p>
<p>The largest decision to make was how to get updates from our GitHub repository.
As I didn&#x27;t want to expose a public SSH port on my home server, I initially
thought about a solution that wouldn&#x27;t directly connect the GitHub repository to
the server. Instead, the server could poll for changes on GitHub, and when
changes are detected, the following would occur:</p>
<ol>
<li>Pull the changes from GitHub</li>
<li>Build a new container</li>
<li>Restart the running container</li>
</ol>
<p>However, we did not end up going with this idea for a few reasons:</p>
<ul>
<li>Unless we polled at a very fast rate, there was still going to be a delay
before we could even detect a change from GitHub</li>
<li>There were concerns with performance from the fact that the Raspberry Pi would
have to do all the building</li>
<li>We would have to create our own scripts to make the polling + building
possible, which would each cost us maintenance time</li>
</ul>
<p>The solution we ended up using for the frontend was to create a nginx Docker
container that is also running a SSH server. Then, to update the frontend, we
could write a GitHub Action to build the frontend, then SSH into the Docker
container and replace the static files in the container. This solution was much
simpler, which would make it easier to maintain. It also does not involve
constantly rebuilding the Docker container, as we would be making local updates
to its filesystem instead. In addition, having the publicly exposed SSH port be
into a container would gave me some more comfort that any attacks would not be
able to immediately access my entire server (though
<a href="https://nvd.nist.gov/vuln/detail/CVE-2024-21626" target="_blank" rel="noopener noreferrer">such</a>
<a href="https://nvd.nist.gov/vuln/detail/CVE-2024-23651" target="_blank" rel="noopener noreferrer">attacks</a>
<a href="https://nvd.nist.gov/vuln/detail/CVE-2024-23652" target="_blank" rel="noopener noreferrer">are</a>
<a href="https://nvd.nist.gov/vuln/detail/CVE-2024-23653" target="_blank" rel="noopener noreferrer">possible</a>).</p>
<p><img decoding="async" loading="lazy" alt="The frontend workflow" src="/trekkers-docs-public/assets/images/upload-frontend-493e9a095082de2326216e6ec666db4c.png" width="943" height="281" class="img_ev3q"></p>
<p>Our GitHub action to build and upload the frontend is included <a href="#appendix-github-action">in the
Appendix</a>. It builds our frontend using <code>npm</code>, and then
uploads it via SCP to the Docker container using
<a href="https://github.com/appleboy/scp-action/" target="_blank" rel="noopener noreferrer">appleboy/scp-action</a>. This ended up
looking like the following:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">name: Deploy Frontend Dev</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">on:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  push:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    branches:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - &quot;project_[0-9]-dev&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jobs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  deploy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: Deploy FE Dev</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    runs-on: ubuntu-latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    concurrency: deploy-group    # optional: ensure only one action runs at a time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    steps:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: Checkout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        uses: actions/checkout@v4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: Build FE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        run: |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         cd frontend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         npm install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         npm run build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: Upload to server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        uses: appleboy/scp-action@v0.1.7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        with:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          host: REDACTED</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          username: REDACTED</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          password: REDACTED</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          port: REDACTED</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          source: &quot;frontend/dist/*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          target: REDACTED</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          overwrite: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          strip_components: 2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>For the backend deployment, we built off of the frontend deployment. Our backend
deployment uses <a href="https://www.npmjs.com/package/tsc-watch" target="_blank" rel="noopener noreferrer">tsc-watch</a> to start up
our backend server, and then monitor for file changes. Then, a GitHub action is
triggered whenever a push has been made to our dev branches, uploading the files
via SCP. <code>tsc-watch</code> is built to automatically detect those changes and rebuild
the backend dynamically as its files change. To support the communication
between our frontend and backend, the backend runs under the same nginx server
as the frontend. Requests to our API endpoints (e.g. /api/v1/users) would then
be forwarded to the backend server, allowing us to remain under the same
subdomain and avoid spawning too many Docker containers for the server to
handle. To make this happen, our <code>nginx.conf</code> includes the following:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location /socket.io {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      proxy_set_header Host $host;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      proxy_set_header X-Real-IP $remote_addr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      proxy_pass REDACTED;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location / {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      root   REDACTED;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      index  index.html;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      try_files $uri $uri/ /index.html;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location /api {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      proxy_set_header Host $host;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      proxy_set_header X-Real-IP $remote_addr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      proxy_pass REDACTED;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    error_page   500 502 503 504  /50x.html;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location = /50x.html {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      root   /usr/share/nginx/html;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>By overwriting what happens with the <code>location /api</code> line configuration, we are
able to redirect requests to go to the backend server rather than still going to
the frontend.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-future">The Future<a href="#the-future" class="hash-link" aria-label="Direct link to The Future" title="Direct link to The Future">​</a></h2>
<p>As Trek continues to develop, our CI/CD system will have to evolve too. One of
our upcoming goals for a future sprint is to integrate testing frameworks into
both our frontend and backend. When our backend develops more, we might also
find that the self-hosted server won&#x27;t be powerful enough. However, with our
maintainable and reproducible system, we are well-equipped to handle these
future challenges with ease.</p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/trekkers-docs-public/blog/tags/project">project</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/trekkers-docs-public/blog/tags/workflow">workflow</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/trekkers-docs-public/blog/tags/ci-cd">ci/cd</a></li></ul></div></div><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2024-07-06-local-deployment.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/trekkers-docs-public/blog/trek-gis-study"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Choosing the Best Geographic Information System (GIS) for Trek</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/trekkers-docs-public/blog/wip-3"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Work In Progress 3</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#my-site" class="table-of-contents__link toc-highlight">My Site</a></li><li><a href="#considerations" class="table-of-contents__link toc-highlight">Considerations</a><ul><li><a href="#security" class="table-of-contents__link toc-highlight">Security</a></li><li><a href="#performance" class="table-of-contents__link toc-highlight">Performance</a></li><li><a href="#maintainability" class="table-of-contents__link toc-highlight">Maintainability</a></li></ul></li><li><a href="#deployment" class="table-of-contents__link toc-highlight">Deployment</a></li><li><a href="#the-future" class="table-of-contents__link toc-highlight">The Future</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/trekkers-docs-public/docs/category/release-notes">Release Notes</a></li></ul></div><div class="col footer__col"><div class="footer__title">Team</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">About Us<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.students.cs.ubc.ca/~cs-455/2024_S/" target="_blank" rel="noopener noreferrer" class="footer__link-item">CPSC 455 Course<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://cs.ubc.ca" target="_blank" rel="noopener noreferrer" class="footer__link-item">UBC CS<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/trekkers-docs-public/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/ubc-cpsc455-2024S/project-04_trekkers" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Trekkers, All rights reserved.</div></div></div></footer></div>
</body>
</html>